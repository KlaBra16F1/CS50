{% extends "layout.html" %}
{% block main %}

    <div>
        <form action="/add-questions" method="post" >
            <select name="topic" id="topic">
                <option value="">Please Select</option>
                {% for r in rows_topics %}
                    <option name="{{ r.t_id }}" value="{{ r.t_id }}">{{ r.topic }}</option>
                {% endfor %}
            </select>
            <select name="subtopic" id="subtopic" onchange="getQuestions();">
                <option value="">Please Select</option>
            </select>
            <button type="submit">Submit</button>  
        </form>
        <p id="table"></p>
    </div>
    </form>
    <!-- externes js -->
    <script>
        let topic = document.querySelector('#topic');
        topic.addEventListener('change', async function() {
            let res = await fetch('/get-subtopics?t_id=' + topic.value);
            document.querySelector('#subtopic').innerHTML = '';
            let subtopics = await res.json();
            let html = '<option value="">Please Select</option>';
            for (s of subtopics) {
                html += '<option value="' + s.s_id + '">' + s.subtopic + '</option>'
            }
            document.querySelector('#subtopic').innerHTML = html;
            getQuestions();
        });

        function getQuestions() {
            let t_id = document.querySelector('#topic').value;
            let s_id = document.querySelector('#subtopic').value;
            console.log(t_id, s_id);
            if (t_id == '') {
                return;
            }
            var req = new XMLHttpRequest();
            req.onreadystatechange = function() {
                if (req.readyState == 4 && req.status == 200) {
                    document.querySelector('#table').innerHTML = req.responseText;
                }
            };
            req.open('GET', '/get-questions?t_id='+ t_id +'&s_id=' + s_id, true);
            req.send();
        }
    </script>
{% endblock %}