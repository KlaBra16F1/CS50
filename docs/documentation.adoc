:source-highlighter: highlight.js
:toc: auto
= Title


== Use Cases

User roles can be `public`,`user`, `maintainer` and `admin`.

[plantuml]
----
@startuml
left to right direction
actor Admin as a
actor Maintainer as m
actor User as u
actor Guest as g
package Website {
    usecase "register" as uc0
    usecase "Create test from topics/subtopics" as uc1
    usecase "Take test" as uc2
    usecase "Store statistics from tests" as uc3
    usecase "View personal statistics" as uc4
    usecase "CRUD topics/subtopics" as uc5
    usecase "CRUD questions/answers" as uc6
    usecase "See all statistics" as uc7
    usecase "CRUD users" as uc8
    (login)
}
g --> uc0
g --> uc1
g --> uc2
g <|-- u
u --> (login)
u --> uc3 
u --> uc4 
u <|-- m 
m --> uc5
m --> uc6
m --> uc7
m <|-- a 
a --> uc8
@enduml
----

== Database

[source,sql]
----
-- static tables
CREATE TABLE users (u_id INTEGER PRIMARY KEY NOT NULL DEFAULT rowid, name TEXT NOT NULL, hash TEXT NOT NULL,role TEXT NOT NULL DEFAULT 'user');

CREATE TABLE topics (t_id INTEGER PRIMARY KEY NOT NULL DEFAULT rowid, topic TEXT NOT NULL);

CREATE TABLE subtopics (s_id INTEGER PRIMARY KEY NOT NULL DEFAULT rowid, t_id INTEGER, subtopic TEXT NOT NULL, FOREIGN KEY (t_id) REFERENCES topics(t_id));

CREATE TABLE questions (q_id INTEGER PRIMARY KEY NOT NULL DEFAULT rowid, s_id INTEGER NOT NULL, question TEXT NOT NULL, difficulty INTEGER DEFAULT 0, isMultipleChoice NUMERIC DEFAULT 0, FOREIGN KEY (s_id) REFERENCES subtopics(s_id));

CREATE TABLE answers (a_id INTEGER PRIMARY KEY NOT NULL DEFAULT rowid, q_id INTEGER NOT NULL, answer TEXT NOT NULL, comment TEXT, is_true NUMERIC NOT NULL DEFAULT 0, FOREIGN KEY (q_id) REFERENCES questions(q_id));

CREATE TABLE user_questions (u_id INTEGER NOT NULL, q_id INTEGER NOT NULL, timesDone INTEGER NOT NULL, timesRight INTEGER NOT NULL, lastDate TEXT);

-- generated tables

----

[mermaid]
----
erDiagram

topics {
    int t_id
    text topic
}
subtopics {
    int s_id
    int t_id
    text subtopic
}
questions {
    int q_id
    int s_id
    text question
    int difficulty
    int isMultipleChoice
}
answers {
    int a_id
    int q_id
    text answer
    text comment
    int true
}
users {
    int u_id
    text name
    text role
}
userQuestions {
    int u_id
    int q_id
    int timesDone
    int timesRight
    text lastDate
}
tests {
    int tst_id
    int u_id
}
testQuestions {
    int tst_id
    int q_id
}

topics ||--o{ subtopics : has
subtopics ||--o{ questions : has
questions ||--o{ answers : has
users ||--o{ userQuestions : n
questions ||--o{ userQuestions : n
users ||--o{ tests : n
tests ||--o{ testQuestions : n
questions ||--o{ testQuestions :n

----

Simple syntax for selecting question and answers in random order.  

`select s.subtopic,q.question from questions q inner join subtopics s using (s_id) where s.t_id=1 union all select row_number() over (order by random()) , a.answer from answers a inner join questions on (a.q_id) ;`

## HTML

Bootstrap 5.3.3 (Css und JS) lokal in `/static`

## CSS

Test mit https://metroui.org.ua[Metro_UI]


[source,html]
----
<head>
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdn.metroui.org.ua/current/metro.css">
    <!-- Icons -->                    
    <link rel="stylesheet" href="https://cdn.metroui.org.ua/current/icons.css">
</head>
----

[source,html]
----
<body>
    ...
    <!-- JavaScript -->
    <script src="https://cdn.metroui.org.ua/current/metro.js"></script>
</body>
----

